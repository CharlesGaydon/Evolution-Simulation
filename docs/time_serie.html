<!DOCTYPE html>

<head>
  
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  
  <style>
    .line {
      fill: none;
      stroke: black;
      stroke-width: 1.5px;
    }
    circle {
      r: 4.5;
      opacity:0.8;
    }

  </style>
</head>

<body>
  <script>
/*
#####################  COMMENTS  ###########################################
      Last edited : 09/11/20177
      Author : Charles Gaydon, 
      Based on
      http://blockbuilder.org/romsson/855207ac5fb5c170de59b9c69ea56012
      and part of the class 
      https://lyondataviz.github.io/teaching/lyon1-m2/2017/tp2.html
###########################################################################
*/

    var svg = d3.select("body").append("svg")
      .attr("width", 960)
      .attr("height", 500);
    function code_event(d){
      if(d.event == "Inv"){
        return("green");
      }else if (d.event == "Del"){
        return("red");
      }else{
        return("#8A2BE2");
      }
    }

    var width = 800;
    var height = 400;

    // See formats http://bl.ocks.org/zanarmstrong/raw/05c1e95bf7aa16c4768e/
    // Data sample {"name": "G", "value": 10, "date": "2016-07"}
    var displayValue = d3.format(",.4f");
    
    // Ordinal scale
    var x = d3.scaleTime()
        .range([0, width]);

    // Linear scale
    var y = d3.scaleLinear()
        .range([height, height - 250]);

    var line = d3.line()
        .x(function(d) { return x(d.time); })
        .y(function(d) { return y(d.fitness); });
    
    var g = svg.append("g")
      .attr("transform", "translate(45, 0)")
    
    d3.csv("sample_history.csv", function(error, data) {
      if (error) throw error;

      // Pre-processing
      data.forEach(function(d) {
        d.fitness = +d.fitness;
        d.time = +d.time
      });
      
      x.domain(d3.extent(data, function(d) { return d.time; }));
      y.domain([0, d3.max(data, function(d) { return d.fitness; })]);
      
      //create date label for each point
      g.selectAll(".label").data(data).enter()
       .append("text")
        .attr("class", "label")
        .text(function(d, i) { return d.time; })
        .attr("y", 400)
        .attr("x", function(d) { return x(d.time); })
        .style("font-size", 10)
        .style("font-family", "monospace");

      // Display last value
      g.selectAll(".last_val").data([data[data.length -1]]).enter()
       .append("text")
        .text(function(d, i) { return displayValue(d.fitness); })
        .attr("class", "value")
        .attr("y", function(d) { return y(d.fitness); })
        .attr("x", width + 10)
        .style("font-size", 20)
        .style("font-family", "monospace");
      
      // create circles for each point
      g.selectAll(".cir").data(data).enter()
      .append('circle')
        .attr("cx",function(d,i){return x(d.time)})
        .attr("cy",function(d) { return y(d.fitness); })
        .attr("r",9)
        .style("opacity",0.8)
        .style("fill",function(d){
            return(code_event(d.event))
      })
        .on("mouseover", function(d, i){
            d3.select(this)
              .style("opacity",1);
        
            d3.selectAll(".label_v")
              .filter(function(el,j){return(i==j)} )
              .style("opacity",1);
        })
        .on("mouseout", function(d, i) {
          d3.select(this).transition().duration(0)
          .style("fill", "gray")
          .style("opacity",.8);
        d3.selectAll(".label_v")
          .style("opacity",0);
      });

            //create value mark for each point
      g.selectAll(".label_val").data(data.slice(0,data.length-1)).enter()
      .append("text")
        .text(function(d, i) { return displayValue(d.fitness); })
        .attr("class", "label_v")
        .attr("y", function(d) { return y(d.fitness)-7; })
        .attr("x", function(d, i) {return(x(d.time) + 7)})
        .style("font-size", 15)
        .style("font-family", "monospace")
        .style("opacity",0);
     
        //create line mark for each point
     g.selectAll(".verline").data(data).enter()
        .append("line")
        .attr("class", "verline")
            .style("fill","none")
      .style("stroke","black")
      .style("stroke-width","0.7px")
        .style("stroke-opacity","1")
        .attr("x1",function(d,i){return x(d.time)})
            .attr("y1",function(d) { return y(d.fitness); })
        .attr("x2",function(d,i){return x(d.time)})
            .attr("y2",height)
      .style("fill", function(d){code_event(d.event)})
        .attr("stroke-dasharray", ("5,3")) ;
    
      g.selectAll(".line").data([data]).enter().append("path")
        .attr("class", "line")
        .attr("d", line);     
    });
    g.append("text")
        .attr("x", (width / 2))             
        .attr("y", 100)
        .attr("text-anchor", "middle")  
        .style("font-size", "20px") 
        .style("text-decoration", "underline")  
        .text("My first Interactive Line Chart");


  </script>
</body>